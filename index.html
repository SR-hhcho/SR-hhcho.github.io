function openQRForVehicle(vehicle, vname){
  const modal = el('#qrModal');
  const canvas = el('#qrCanvas');
  const title = el('#qrTitle');
  const downloadBtn = el('#qrDownload');
  const closeBtn = el('#qrClose');

  const base = location.origin + location.pathname.replace(/index\.html?$/,'');
  const url  = base + '#/' + encodeURIComponent(vehicle);

  title.textContent = vname+' ('+vehicle+') 페이지 QR';
  modal.classList.add('show');            // ✅ 먼저 보여주고

  // QR 생성 (에러시 토스트)
  try{
    QRCode.toCanvas(canvas, url, {width:256, margin:1}, function(err){
      if(err){ toast('QR 생성 실패', false); }
    });
  }catch(e){ toast('QR 라이브러리 로드 실패', false); }

  // 다운로드
  downloadBtn.onclick = function(){
    const a = document.createElement('a');
    a.download = 'QR_'+vehicle+'.png';
    a.href = canvas.toDataURL('image/png');
    a.click();
  };

  // 공유(지원되는 경우에만)
  let shareBtn = document.getElementById('qrShare');
  if(!shareBtn){
    shareBtn = ce('button',{className:'btn',id:'qrShare',type:'button',textContent:'공유'});
    downloadBtn.parentElement.insertBefore(shareBtn, downloadBtn.nextSibling);
  }
  if(navigator.share){
    shareBtn.style.display = '';
    shareBtn.onclick = async ()=>{
      try{
        const blob = await new Promise(r=>canvas.toBlob(r,'image/png'));
        const file = new File([blob],'QR_'+vehicle+'.png',{type:'image/png'});
        await navigator.share({
          title: vname+' QR',
          text: '차량 페이지 바로가기',
          url,                                  // 일부 브라우저는 URL만 공유
          files: (navigator.canShare && navigator.canShare({files:[file]})) ? [file] : undefined
        });
      }catch(e){ /* 사용자가 취소할 수 있으니 조용히 무시 */ }
    };
  }else{
    shareBtn.style.display = 'none';
  }

  const close = ()=> modal.classList.remove('show');
  closeBtn.onclick = close;
  modal.onclick = (e)=>{ if(e.target===modal) close(); };
}
